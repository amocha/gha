name: 'Onboarding'
run-name: 'Onboarding'
on: push
jobs:
  npd-onboarding:
    runs-on: ubuntu-latest
    environment: "NPD"
    env:
      env-class: "npd"
    steps:
        - name: checkout
          uses: actions/checkout@v4
        - name: AZ cli login 
          run: |
              echo "${{ secrets.CLIENT_CERTIFICATE }}" | base64 -d > cert.pem
              az login --service-principal -u ${{ secrets.CLIENT_ID }} -p cert.pem --tenant ${{ secrets.TENANT_ID }} -o none
              az account set -s ${{ secrets.AKS_SUBSCRIPTION_ID }}
   
        - name: setup python
          uses: actions/setup-python@v4
          with:
            python-version: '3.10' # install the python version needed 

        - name: install python packages
          run: |
            python -m pip install --upgrade pip
            pip install -r scripts/requirements.txt 
            
        - name: Execute Onboarding
          run: python scripts/onboard.py
          

  prd-onboarding:
    runs-on: ubuntu-latest
    steps:
        - name: checkout
          uses: actions/checkout@v4
        - run: |
            env
          working-directory: ./teams/prd
    

            #onboard-team:
            #  runs-on: de-arc-runner-shared-npd
            #  steps:
            #      - name: checkout
            #        uses: actions/checkout@v4
            #      
            #      - name: Prepare onboarding list
            #        run: | 
            #             echo "Iterate through the teams yaml in teams folder and identify which teams are not onboarded or need to be reonboarded"
            #      
            #      - name: Run Onboarding
            #        run: | 
            #            echo "run onboarding  using  strategy matrix"

            #      - name: setup python
            #        uses: actions/setup-python@v4
            #        with:
            #          python-version: '3.10' # install the python version needed 

            #      - name: install python packages
            #        run: |
            #          python -m pip install --upgrade pip
            #          pip install -r scripts/requirements.txt 
            #          
            #      - name: Execute Onboarding
            #        run: python scripts/onboard.py
